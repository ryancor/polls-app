<%= form_tag votes_path, method: :post, remote: true, id: 'voting_form' do %>
  <%= hidden_field_tag 'poll[id]', @poll.id %>

  <%= render partial: 'polls/vote_option', collection: @poll.vote_options, as: :option %>

  <p><b>Total votes: <%= @poll.votes_summary %></b></p>

  <% if current_user.voted_for?(@poll) %>
    <p>You have already voted!</p>
    <% if current_user.voted_for?(@poll) && @poll.votes.count == 1 %>
    	<p>Users who also voted: You're the first!</p>
    <% else %>
    	<p>Users who also voted: <%= @poll.votes.joins(:user).where('users.id != ?', current_user.id).map(&:user).map(&:name).join(" ") %></p>
    <% end %>
  <% else %>
    <%= submit_tag 'Vote', class: 'btn btn-lg btn-primary' %>
  <% end %>
<% end %>